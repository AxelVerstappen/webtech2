<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Untitled Document</title>
<script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
</head>

<body onload="getLocation()">
	<script>
    function getLocation()
    {
    	if (navigator.geolocation)
        {
        	navigator.geolocation.getCurrentPosition(usePosition);
        }
    	else{
			alert("Geolocation is not supported by this browser.");
		}
    }
	
    function usePosition(position)
    {
		var date = new Date();
		var dateTime = date.getTime();
		var clearDateTimeData = localStorage.getItem('clearDateTimeData');
		
		//wanneer er nog geen uur voorbij is en de api nog gehouden mag worden.
		if(dateTime >= (clearDateTimeData) || typeof(clearDateTimeData) == null){
			localStorage.clear();
			var clearDate = new Date();
			var clearDateTime = clearDate.getTime()+3600000;
			localStorage.setItem('clearDateTimeData', clearDateTime);
			
				//nieuwe api wordt binnengehaald
				$.ajax({
					url: "https://api.forecast.io/forecast/e05e552399a601ca2b25c8092be9198e/"+position.coords.latitude+","+position.coords.longitude,
					dataType: 'jsonp'
					})
					.done(function(data){
						var dataToStore = JSON.stringify(data);
						localStorage.setItem('someData', dataToStore);
						var localData = JSON.parse(localStorage.getItem('someData'));
						console.log(localData, "Nieuwe data");
				});
		}
		
		//wanneer er gecleared mag worden en een nieuwe api opgehaald mag worden.
		else{
			var localData = JSON.parse(localStorage.getItem('someData'));	
			console.log(localData, "Oude data");
		}
		var formule = (5/9);
		for(var i=0; i<localData.daily.data.length; i++){
			var formuleC = (localData.daily.data[i].temperatureMax - 32)*(5/9);
			var day= date.getDay()+ i;
			/*if(day >= 8)
			{
				day = i-(i-1) ;	
			}*/
			console.log(day);
			
			$("#weekView").append("<li>"+formuleC.toFixed(2)+" °C</li>");
		}
		
		var temperatureMaxTomF = (localData.currently.temperature - 32)* (5/9);
		var temperatureMaxTomC = temperatureMaxTomF.toFixed(2);
		document.getElementById("temperatuur").innerHTML=temperatureMaxTomC + " °C";
      }
    </script>
    <h1>Temperatuur nu:</h1>
    <h1 id="temperatuur"></h1>
    <ul id="weekView">
    	
    </ul>
</body>
</html>
