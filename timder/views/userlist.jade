extends layout

block content
  h1= "Selectie voor: " + companyname
  
  ul#userlist
     - for (var t = 0; t <= 2; ++t)
       each user, i in userlist
         li.listitems
          h3= user.firstname + " " + user.lastname
          img(src=user.workphotos[t].photo)
          p= user.workdescriptions[t].description
          input(class="likeBtn likeDislikeBtns", type="button", value="Like")
          input(class="dislikeBtn likeDislikeBtns", type="button", value="Dislike")
     
  form#herStartForm(name="herstart",method="post",action="/resetcompanyuser")
   button#btnSubmit(type="submit", style="display: none;") Herstarten!

  script.
   $( document ).ready(function() {
    var client = new Faye.Client('/faye',{
     timeout: 20
    });
    
    
    //Lijst at random sorteren
    var $ul = $('#userlist');
    $('li', $ul).sort(function(){
        return (Math.round(Math.random())-0.5)
    }).appendTo($ul);
    
    
    //Post naar scoreboard en databank bij een like en fadeout erna
    $(".likeBtn").click(function(e) {
     var voteName = $(this).parent().find('h3');

     client.publish('/channel', {
      text: voteName.text()
     });
     
     $.ajax({
      type: 'POST',
      url: "/insertvotes",
      data: {votedname: voteName.text()},
      success: function (data) {
        console.log("Success");
      },
      dataType: "json"
     });
     
     e.preventDefault();
    });
    
    
    //Fadeout bij een dislike
    $(".likeDislikeBtns").click(function(e){
     var parent = $(this).parent();
     
     parent.fadeOut("slow", function(){
        parent.attr('class', 'invisible');
        var checklistitems = document.getElementsByClassName('listitems');
        if(checklistitems.length == 0)
        {
         $("#btnSubmit").css("display", "block");
        }
     });
     e.preventDefault();
    });
   });